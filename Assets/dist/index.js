/*! grapesjs-block-loader-bundle - 1.0.5 */
!function(e,o){'object'==typeof exports&&'object'==typeof module?module.exports=o():'function'==typeof define&&define.amd?define([],o):'object'==typeof exports?exports["grapesjs-block-loader-bundle"]=o():e["grapesjs-block-loader-bundle"]=o()}('undefined'!=typeof globalThis?globalThis:'undefined'!=typeof window?window:this,()=>(()=>{"use strict";var e={r:e=>{'undefined'!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:'Module'}),Object.defineProperty(e,'__esModule',{value:!0})}},o={};e.r(o);var t=void 0&&(void 0).__awaiter||function(e,o,t,n){return new(t||(t=Promise))(function(r,a){function l(e){try{c(n.next(e))}catch(e){a(e)}}function i(e){try{c(n["throw"](e))}catch(e){a(e)}}function c(e){var o;e.done?r(e.value):(o=e.value,o instanceof t?o:new t(function(e){e(o)})).then(l,i)}c((n=n.apply(e,o||[])).next())})},n=void 0&&(void 0).__generator||function(e,o){var t,n,r,a,l={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function i(i){return function(c){return function(i){if(t)throw new TypeError("Generator is already executing.");for(;a&&(a=0,i[0]&&(l=0)),l;)try{if(t=1,n&&(r=2&i[0]?n["return"]:i[0]?n["throw"]||((r=n["return"])&&r.call(n),0):n.next)&&!(r=r.call(n,i[1])).done)return r;switch(n=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return l.label++,{value:i[1],done:!1};case 5:l.label++,n=i[1],i=[0];continue;case 7:i=l.ops.pop(),l.trys.pop();continue;default:if(!(r=l.trys,(r=r.length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){l=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){l.label=i[1];break}if(6===i[0]&&l.label<r[1]){l.label=r[1],r=i;break}if(r&&l.label<r[2]){l.label=r[2],l.ops.push(i);break}r[2]&&l.ops.pop(),l.trys.pop();continue}i=o.call(e,l)}catch(e){i=[6,e],n=0}finally{t=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}};window.CustomBlockLoaderNamespace=window.CustomBlockLoaderNamespace||{};return window.MauticGrapesJsPlugins||(window.MauticGrapesJsPlugins=[]),window.MauticGrapesJsPlugins.push({name:'GrapesJsBlockLoader',plugin:function(e){e.on('load',function(){var o='',r='';if(null!==window.id&&null!==window.id[0]&&void 0!==window.id[0])'page_sessionId'===window.id[0].id?r='page':'emailform_sessionId'===window.id[0].id&&(r='email');else{var a=document.querySelector('div.builder.email-builder'),l=document.querySelector('div.builder.page-builder');null!==a?r='email':null!==l&&(r='page')}if(null!==window.Mautic&&null!==window.Mautic.builderTheme)o=window.Mautic.builderTheme;else{var i=document.querySelectorAll('button.select-theme-selected');if(null!==i)Array.from(i).forEach(function(e){if(!e.classList.contains('hide')){var t=e.parentElement;if(null!==t){var n=t.querySelector('a.select-theme-link.btn.btn-default.hide');null!==n&&n instanceof HTMLElement&&(o=n.dataset.theme)}}})}if(null!=o&&''!==o&&''!==r){o=o.toLowerCase();var c='';'page'===r?c="/themes/".concat(o,"/blocks/blocks-page.js"):(r='email')&&(c="/themes/".concat(o,"/blocks/blocks-email.js"));var s=document.getElementById('injectedBlocksScript');return null!==s&&s.remove(),new Promise(function(o,r){var a=document.createElement('script');a.type='text/javascript',a.charset='utf-8',a.async=!0,a.id='injectedBlocksScript',a.src=c,a.onload=function(){return t(void 0,void 0,void 0,function(){var t,r,l,i,c,s,u,d,p,f,m,w,b;return n(this,function(n){switch(n.label){case 0:for(c in o(a),t=e.BlockManager,!0===window.CustomBlockLoaderNamespace.removeDefaults&&t.getAll().reset(),r={},l=window.CustomBlockLoaderNamespace.templates,i=[],l)i.push(c);s=0,n.label=1;case 1:if(!(s<i.length))return[3,8];if(!((c=i[s])in l))return[3,7];if(w=c,'string'!=typeof(u=window.CustomBlockLoaderNamespace.templates[w]))return[3,7];n.label=2;case 2:return n.trys.push([2,6,,7]),[4,fetch(u)];case 3:return(d=n.sent()).ok?(p=r,f=w,[4,d.text()]):[3,5];case 4:p[f]=n.sent(),n.label=5;case 5:return[3,7];case 6:return m=n.sent(),console.error("Error fetching template file: ".concat(u),m),[3,7];case 7:return s++,[3,1];case 8:for(w in window.CustomBlockLoaderNamespace.blocks)'string'==typeof w&&('templateFile'in window.CustomBlockLoaderNamespace.blocks[w]&&'string'==typeof window.CustomBlockLoaderNamespace.blocks[w].templateFile&&(window.CustomBlockLoaderNamespace.blocks[w].content=r[window.CustomBlockLoaderNamespace.blocks[w].templateFile]||window.CustomBlockLoaderNamespace.blocks[w].content),delete window.CustomBlockLoaderNamespace.blocks[w].templateFile,b=window.CustomBlockLoaderNamespace.blocks[w],console.log(b),t.add(w,b));return[2]}})})},a.onerror=function(e){r(new Error("Script load error for ".concat(c)))},document.body.appendChild(a)}).catch(function(e){return console.log(e.message)})}})},context:['page','email-mjml','email-html']}),o})());
//# sourceMappingURL=index.js.map