/*! grapesjs-block-loader-bundle - 1.0.5 */
!function(e,o){'object'==typeof exports&&'object'==typeof module?module.exports=o():'function'==typeof define&&define.amd?define([],o):'object'==typeof exports?exports["grapesjs-block-loader-bundle"]=o():e["grapesjs-block-loader-bundle"]=o()}('undefined'!=typeof globalThis?globalThis:'undefined'!=typeof window?window:this,()=>(()=>{"use strict";var e={r:e=>{'undefined'!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:'Module'}),Object.defineProperty(e,'__esModule',{value:!0})}},o={};e.r(o);var t=void 0&&(void 0).__awaiter||function(e,o,t,n){return new(t||(t=Promise))(function(r,a){function l(e){try{i(n.next(e))}catch(e){a(e)}}function c(e){try{i(n["throw"](e))}catch(e){a(e)}}function i(e){var o;e.done?r(e.value):(o=e.value,o instanceof t?o:new t(function(e){e(o)})).then(l,c)}i((n=n.apply(e,o||[])).next())})},n=void 0&&(void 0).__generator||function(e,o){var t,n,r,a,l={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(c){return function(i){return function(c){if(t)throw new TypeError("Generator is already executing.");for(;a&&(a=0,c[0]&&(l=0)),l;)try{if(t=1,n&&(r=2&c[0]?n["return"]:c[0]?n["throw"]||((r=n["return"])&&r.call(n),0):n.next)&&!(r=r.call(n,c[1])).done)return r;switch(n=0,r&&(c=[2&c[0],r.value]),c[0]){case 0:case 1:r=c;break;case 4:return l.label++,{value:c[1],done:!1};case 5:l.label++,n=c[1],c=[0];continue;case 7:c=l.ops.pop(),l.trys.pop();continue;default:if(!(r=l.trys,(r=r.length>0&&r[r.length-1])||6!==c[0]&&2!==c[0])){l=0;continue}if(3===c[0]&&(!r||c[1]>r[0]&&c[1]<r[3])){l.label=c[1];break}if(6===c[0]&&l.label<r[1]){l.label=r[1],r=c;break}if(r&&l.label<r[2]){l.label=r[2],l.ops.push(c);break}r[2]&&l.ops.pop(),l.trys.pop();continue}c=o.call(e,l)}catch(e){c=[6,e],n=0}finally{t=r=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,i])}}};window.CustomBlockLoaderNamespace=window.CustomBlockLoaderNamespace||{},console.log('test');return window.MauticGrapesJsPlugins||(window.MauticGrapesJsPlugins=[]),window.MauticGrapesJsPlugins.push({name:'GrapesJsBlockLoader',plugin:function(e){console.log('test1'),console.log(e),e.on('load',function(){console.log('test2');var o='',r='';if(null!==window.id&&null!==window.id[0]&&void 0!==window.id[0])'page_sessionId'===window.id[0].id?r='page':'emailform_sessionId'===window.id[0].id&&(r='email');else{var a=document.querySelector('div.builder.email-builder'),l=document.querySelector('div.builder.page-builder');null!==a?r='email':null!==l&&(r='page')}if(null!==window.Mautic&&null!==window.Mautic.builderTheme)o=window.Mautic.builderTheme;else{var c=document.querySelectorAll('button.select-theme-selected');if(null!==c)Array.from(c).forEach(function(e){if(!e.classList.contains('hide')){var t=e.parentElement;if(null!==t){var n=t.querySelector('a.select-theme-link.btn.btn-default.hide');null!==n&&n instanceof HTMLElement&&(o=n.dataset.theme)}}})}if(null!=o&&''!==o&&''!==r){o=o.toLowerCase();var i='';'page'===r?i="themes/".concat(o,"/blocks/blocks-page.js"):(r='email')&&(i="themes/".concat(o,"/blocks/blocks-email.js"));var s=document.getElementById('injectedBlocksScript');return null!==s&&s.remove(),new Promise(function(o,r){var a=document.createElement('script');a.type='text/javascript',a.charset='utf-8',a.async=!0,a.id='injectedBlocksScript',a.src=i,a.onload=function(){return t(void 0,void 0,void 0,function(){var t,r,l,c,i,s,u,d,p,f,m,w,b;return n(this,function(n){switch(n.label){case 0:for(i in o(a),t=e.BlockManager,!0===window.CustomBlockLoaderNamespace.removeDefaults&&t.getAll().reset(),r={},l=window.CustomBlockLoaderNamespace.templates,c=[],l)c.push(i);s=0,n.label=1;case 1:if(!(s<c.length))return[3,8];if(!((i=c[s])in l))return[3,7];if(w=i,'string'!=typeof(u=window.CustomBlockLoaderNamespace.templates[w]))return[3,7];n.label=2;case 2:return n.trys.push([2,6,,7]),[4,fetch(u)];case 3:return(d=n.sent()).ok?(p=r,f=w,[4,d.text()]):[3,5];case 4:p[f]=n.sent(),n.label=5;case 5:return[3,7];case 6:return m=n.sent(),console.error("Error fetching template file: ".concat(u),m),[3,7];case 7:return s++,[3,1];case 8:for(w in window.CustomBlockLoaderNamespace.blocks)'string'==typeof w&&('templateFile'in window.CustomBlockLoaderNamespace.blocks[w]&&'string'==typeof window.CustomBlockLoaderNamespace.blocks[w].templateFile&&(window.CustomBlockLoaderNamespace.blocks[w].content=r[window.CustomBlockLoaderNamespace.blocks[w].templateFile]||window.CustomBlockLoaderNamespace.blocks[w].content),delete window.CustomBlockLoaderNamespace.blocks[w].templateFile,b=window.CustomBlockLoaderNamespace.blocks[w],console.log(b),t.add(w,b));return[2]}})})},a.onerror=function(e){console.error("Primary script load failed for ".concat(i,", trying absolute path fallback"));var o=document.createElement('script');o.type='text/javascript',o.charset='utf-8',o.async=!0,o.id='injectedBlocksScriptFallback',o.src="/".concat(i),o.onload=a.onload,o.onerror=function(e){r(new Error("Script load error for both ".concat(i," and /").concat(i)))},document.body.appendChild(o)},document.body.appendChild(a)}).catch(function(e){return console.log(e.message)})}})},context:[]}),console.log(window.MauticGrapesJsPlugins),o})());
//# sourceMappingURL=index.js.map