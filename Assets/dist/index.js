/*! grapesjs-block-loader-bundle - 1.0.7 */
!function(e,o){'object'==typeof exports&&'object'==typeof module?module.exports=o():'function'==typeof define&&define.amd?define([],o):'object'==typeof exports?exports["grapesjs-block-loader-bundle"]=o():e["grapesjs-block-loader-bundle"]=o()}('undefined'!=typeof globalThis?globalThis:'undefined'!=typeof window?window:this,()=>(()=>{"use strict";var e={r:e=>{'undefined'!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:'Module'}),Object.defineProperty(e,'__esModule',{value:!0})}},o={};e.r(o);var t=void 0&&(void 0).__awaiter||function(e,o,t,n){return new(t||(t=Promise))(function(l,r){function a(e){try{c(n.next(e))}catch(e){r(e)}}function i(e){try{c(n["throw"](e))}catch(e){r(e)}}function c(e){var o;e.done?l(e.value):(o=e.value,o instanceof t?o:new t(function(e){e(o)})).then(a,i)}c((n=n.apply(e,o||[])).next())})},n=void 0&&(void 0).__generator||function(e,o){var t,n,l,r,a={label:0,sent:function(){if(1&l[0])throw l[1];return l[1]},trys:[],ops:[]};return r={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function i(i){return function(c){return function(i){if(t)throw new TypeError("Generator is already executing.");for(;r&&(r=0,i[0]&&(a=0)),a;)try{if(t=1,n&&(l=2&i[0]?n["return"]:i[0]?n["throw"]||((l=n["return"])&&l.call(n),0):n.next)&&!(l=l.call(n,i[1])).done)return l;switch(n=0,l&&(i=[2&i[0],l.value]),i[0]){case 0:case 1:l=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(l=a.trys,(l=l.length>0&&l[l.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!l||i[1]>l[0]&&i[1]<l[3])){a.label=i[1];break}if(6===i[0]&&a.label<l[1]){a.label=l[1],l=i;break}if(l&&a.label<l[2]){a.label=l[2],a.ops.push(i);break}l[2]&&a.ops.pop(),a.trys.pop();continue}i=o.call(e,a)}catch(e){i=[6,e],n=0}finally{t=l=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}};window.CustomBlockLoaderNamespace=window.CustomBlockLoaderNamespace||{};return window.MauticGrapesJsPlugins||(window.MauticGrapesJsPlugins=[]),window.MauticGrapesJsPlugins.push({name:'GrapesJsBlockLoader',plugin:function(e){console.log('called 1'),e.on('load',function(){console.log('called 2');var o='',l='';if(null!==window.id&&null!==window.id[0]&&void 0!==window.id[0])'page_sessionId'===window.id[0].id?l='page':'emailform_sessionId'===window.id[0].id&&(l='email');else{var r=document.querySelector('div.builder.email-builder'),a=document.querySelector('div.builder.page-builder');null!==r?l='email':null!==a&&(l='page')}if(null!==window.Mautic&&null!==window.Mautic.builderTheme)o=window.Mautic.builderTheme;else{var i=document.querySelectorAll('button.select-theme-selected');if(null!==i)Array.from(i).forEach(function(e){if(!e.classList.contains('hide')){var t=e.parentElement;if(null!==t){var n=t.querySelector('a.select-theme-link.btn.btn-default.hide');null!==n&&n instanceof HTMLElement&&(o=n.dataset.theme)}}})}if(null!=o&&''!==o&&''!==l){o=o.toLowerCase();var c='';'page'===l?c="/themes/".concat(o,"/blocks/blocks-page.js"):(l='email')&&(c="/themes/".concat(o,"/blocks/blocks-email.js"));var s=document.getElementById('injectedBlocksScript');return null!==s&&s.remove(),new Promise(function(o,l){var r=document.createElement('script');r.type='text/javascript',r.charset='utf-8',r.async=!0,r.id='injectedBlocksScript',r.src=c,r.onload=function(){return t(void 0,void 0,void 0,function(){var t,l,a,i,c,s,u,d,p,f,m,w,b;return n(this,function(n){switch(n.label){case 0:for(c in o(r),t=e.BlockManager,!0===window.CustomBlockLoaderNamespace.removeDefaults&&t.getAll().reset(),l={},a=window.CustomBlockLoaderNamespace.templates,i=[],a)i.push(c);s=0,n.label=1;case 1:if(!(s<i.length))return[3,8];if(!((c=i[s])in a))return[3,7];if(w=c,'string'!=typeof(u=window.CustomBlockLoaderNamespace.templates[w]))return[3,7];n.label=2;case 2:return n.trys.push([2,6,,7]),[4,fetch(u)];case 3:return(d=n.sent()).ok?(p=l,f=w,[4,d.text()]):[3,5];case 4:p[f]=n.sent(),n.label=5;case 5:return[3,7];case 6:return m=n.sent(),console.error("Error fetching template file: ".concat(u),m),[3,7];case 7:return s++,[3,1];case 8:for(w in window.CustomBlockLoaderNamespace.blocks)'string'==typeof w&&('templateFile'in window.CustomBlockLoaderNamespace.blocks[w]&&'string'==typeof window.CustomBlockLoaderNamespace.blocks[w].templateFile&&(window.CustomBlockLoaderNamespace.blocks[w].content=l[window.CustomBlockLoaderNamespace.blocks[w].templateFile]||window.CustomBlockLoaderNamespace.blocks[w].content),delete window.CustomBlockLoaderNamespace.blocks[w].templateFile,b=window.CustomBlockLoaderNamespace.blocks[w],console.log(b),t.add(w,b));return[2]}})})},r.onerror=function(e){l(new Error("Script load error for ".concat(c)))},document.body.appendChild(r)}).catch(function(e){return console.log(e.message)})}})},context:['page','email-mjml','email-html']}),o})());
//# sourceMappingURL=index.js.map