{"version":3,"file":"index.js","mappings":"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","sources":["webpack://grapesjs-block-loader-bundle/webpack/universalModuleDefinition","webpack://grapesjs-block-loader-bundle/webpack/bootstrap","webpack://grapesjs-block-loader-bundle/webpack/runtime/make namespace object","webpack://grapesjs-block-loader-bundle/./Assets/src/index.ts"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"grapesjs-block-loader-bundle\"] = factory();\n\telse\n\t\troot[\"grapesjs-block-loader-bundle\"] = factory();\n})(typeof globalThis !== 'undefined' ? globalThis : (typeof window !== 'undefined' ? window : this), () => {\nreturn ","// The require scope\nvar __webpack_require__ = {};\n\n","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","import grapesjs from 'grapesjs';\n\n// declare type for window so TS will not complain during compiling\ndeclare global {\n    interface Window {\n        MauticGrapesJsPlugins: object[];\n        CustomBlockLoaderNamespace: any;\n        id: any;\n        Mautic: any;\n    }\n}\n\nwindow.CustomBlockLoaderNamespace = window.CustomBlockLoaderNamespace || {};\n\nconst GrapesJsBlockLoader: grapesjs.Plugin = (editor) => {\n    editor.on('load', () => {\n        let themePath:any = '';\n        let editorType = '';\n        \n        if ( window.id !== null && window.id[0] !== null && typeof window.id[0] !== 'undefined' ) {\n            if ( window.id[0].id === 'page_sessionId' ) {\n                editorType = 'page';\n            } else if ( window.id[0].id === 'emailform_sessionId' ) {\n                editorType = 'email';\n            }\n        } else {\n            const emailBuilder = document.querySelector( 'div.builder.email-builder' );\n            const pageBuilder = document.querySelector( 'div.builder.page-builder' );\n            if ( emailBuilder !== null ) {\n                editorType = 'email';\n            } else if ( pageBuilder !== null ) {\n                editorType = 'page';\n            }\n        }\n        \n        if ( window.Mautic !== null && window.Mautic.builderTheme !== null) {\n            themePath = window.Mautic.builderTheme;\n        } else {\n            const themeSelectedBtn = document.querySelectorAll( 'button.select-theme-selected' );\n            if ( themeSelectedBtn !== null ) {\n                const selectBtns = Array.from( themeSelectedBtn );\n                selectBtns.forEach( button => {\n                    if ( !button.classList.contains( 'hide' ) ) {\n                        const parentOfThemeSelectedBtn = button.parentElement;\n                        if ( parentOfThemeSelectedBtn !== null ) {\n                            let themeHeading = parentOfThemeSelectedBtn.querySelector( 'a.select-theme-link.btn.btn-default.hide' );\n                            if ( themeHeading !== null ) {\n                                if ( themeHeading instanceof HTMLElement) {\n                                    themePath = themeHeading.dataset.theme;\n                                }\n                            }\n                        }\n                    }\n                } );\n            }\n        }\n        \n        if ( themePath !== null && typeof themePath !== \"undefined\" && themePath !== '' && editorType !== '' ) {\n            themePath = themePath.toLowerCase();\n            let url = '';\n            let scriptId = '';\n            if ( editorType === 'page' ) {\n                url = `/themes/${themePath}/blocks/blocks-page.js`;\n                scriptId = `${themePath}-page`;\n            } else if ( editorType = 'email' ) {\n                url = `/themes/${themePath}/blocks/blocks-email.js`;\n                scriptId = `${themePath}-email`;\n            }\n            \n            const injectedScript = document.getElementById( scriptId );\n            if ( injectedScript === null ) {\n                console.log( 'Will try to load: ' + url );\n                \n                return new Promise( (resolve, reject) => {\n                    let script  = document.createElement('script');\n                    script.type = 'text/javascript';\n                    script.charset = 'utf-8';\n                    script.async = true;\n                    script.id = scriptId;\n                    script.src = url;\n                    script.onload = function () {\n                        resolve(script);\n                        const bm = editor.BlockManager;\n                        if ( window.CustomBlockLoaderNamespace.removeDefaults ) {\n                            bm.getAll().reset();\n                        }\n                        \n                        for ( const id in window.CustomBlockLoaderNamespace.blocks ) {\n                            bm.add( id, window.CustomBlockLoaderNamespace.blocks[id] );\n                        }\n                    };\n                    script.onerror = function () {\n                        reject(new Error(`Script load error for ${url}`))\n                    };\n                    document.body.appendChild(script);\n                } );\n            } else {\n                const bm = editor.BlockManager;\n                if ( window.CustomBlockLoaderNamespace.removeDefaults ) {\n                    bm.getAll().reset();\n                }\n                \n                for ( const id in window.CustomBlockLoaderNamespace.blocks ) {\n                    bm.add( id, window.CustomBlockLoaderNamespace.blocks[id] );\n                }\n            }\n        }\n    });\n}\n\n// register the plugin globally so Mautic-GrapesJS can find it during initialization\nif (!window.MauticGrapesJsPlugins) window.MauticGrapesJsPlugins = [];\nwindow.MauticGrapesJsPlugins.push({\n    name: 'GrapesJsBlockLoader',\n    plugin: GrapesJsBlockLoader,\n    context: ['page', 'email-mjml'] // options: [page|email-mjml|email-html]\n})\n"],"names":["root","factory","exports","module","define","amd","globalThis","window","this","__webpack_require__","Symbol","toStringTag","Object","defineProperty","value","CustomBlockLoaderNamespace","MauticGrapesJsPlugins","push","name","plugin","editor","on","themePath","editorType","id","emailBuilder","document","querySelector","pageBuilder","Mautic","builderTheme","themeSelectedBtn","querySelectorAll","Array","from","forEach","button","classList","contains","parentOfThemeSelectedBtn","parentElement","themeHeading","HTMLElement","dataset","theme","toLowerCase","getElementById","console","log","Promise","resolve","reject","script","createElement","type","charset","async","src","onload","bm","BlockManager","removeDefaults","getAll","reset","blocks","add","onerror","Error","body","appendChild","context"],"sourceRoot":""}