{"version":3,"file":"index.js","mappings":"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","sources":["webpack://grapesjs-block-loader-bundle/webpack/universalModuleDefinition","webpack://grapesjs-block-loader-bundle/webpack/bootstrap","webpack://grapesjs-block-loader-bundle/webpack/runtime/make namespace object","webpack://grapesjs-block-loader-bundle/./Assets/src/index.ts"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"grapesjs-block-loader-bundle\"] = factory();\n\telse\n\t\troot[\"grapesjs-block-loader-bundle\"] = factory();\n})(typeof globalThis !== 'undefined' ? globalThis : (typeof window !== 'undefined' ? window : this), () => {\nreturn ","// The require scope\nvar __webpack_require__ = {};\n\n","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","import grapesjs from 'grapesjs';\nimport { IBlockAttributes, IBlockItem } from './interfaces';\n\n// declare type for window so ts will not complain during compiling\ndeclare global {\n\tinterface Window {\n\t\tMauticGrapesJsPlugins: object[];\n\t\tCustomBlockLoaderNamespace: any;\n\t\tid: any;\n\t\tMautic: any;\n\t}\n}\n\nwindow.CustomBlockLoaderNamespace = window.CustomBlockLoaderNamespace || {};\n\nconst GrapesJsBlockLoader: grapesjs.Plugin = (editor) => {\n\tconsole.log('called 1');\n\teditor.on('load', () => {\n\t\tconsole.log('called 2');\n\t\tlet themePath: any = '';\n\t\tlet editorType = '';\n\n\t\t// email or page builder?\n\t\tif (window.id !== null && window.id[0] !== null && typeof window.id[0] !== 'undefined') {\n\t\t\tif (window.id[0].id === 'page_sessionId') {\n\t\t\t\teditorType = 'page';\n\t\t\t} else if (window.id[0].id === 'emailform_sessionId') {\n\t\t\t\teditorType = 'email';\n\t\t\t}\n\t\t} else {\n\t\t\tconst emailBuilder = document.querySelector('div.builder.email-builder');\n\t\t\tconst pageBuilder = document.querySelector('div.builder.page-builder');\n\t\t\tif (emailBuilder !== null) {\n\t\t\t\teditorType = 'email';\n\t\t\t} else if (pageBuilder !== null) {\n\t\t\t\teditorType = 'page';\n\t\t\t}\n\t\t}\n\n\t\t// get the theme path\n\t\tif (window.Mautic !== null && window.Mautic.builderTheme !== null) {\n\t\t\tthemePath = window.Mautic.builderTheme;\n\t\t} else {\n\t\t\tconst themeSelectedBtn = document.querySelectorAll('button.select-theme-selected');\n\t\t\tif (themeSelectedBtn !== null) {\n\t\t\t\tconst selectBtns = Array.from(themeSelectedBtn);\n\t\t\t\tselectBtns.forEach((button) => {\n\t\t\t\t\tif (!button.classList.contains('hide')) {\n\t\t\t\t\t\tconst parentOfThemeSelectedBtn = button.parentElement;\n\t\t\t\t\t\tif (parentOfThemeSelectedBtn !== null) {\n\t\t\t\t\t\t\tlet themeHeading = parentOfThemeSelectedBtn.querySelector('a.select-theme-link.btn.btn-default.hide');\n\t\t\t\t\t\t\tif (themeHeading !== null) {\n\t\t\t\t\t\t\t\tif (themeHeading instanceof HTMLElement) {\n\t\t\t\t\t\t\t\t\tthemePath = themeHeading.dataset.theme;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tif (themePath !== null && typeof themePath !== 'undefined' && themePath !== '' && editorType !== '') {\n\t\t\tthemePath = themePath.toLowerCase();\n\t\t\tlet url = '';\n\t\t\tlet scriptId = '';\n\t\t\tif (editorType === 'page') {\n\t\t\t\turl = `/themes/${themePath}/blocks/blocks-page.js`;\n\t\t\t} else if ((editorType = 'email')) {\n\t\t\t\turl = `/themes/${themePath}/blocks/blocks-email.js`;\n\t\t\t}\n\n\t\t\t// test if script is already injected, remove if so\n\t\t\tconst injectedScript = document.getElementById('injectedBlocksScript');\n\t\t\tif (injectedScript !== null) {\n\t\t\t\tinjectedScript.remove();\n\t\t\t}\n\n\t\t\t// load and inject script\n\t\t\t// console.log( 'Will try to load: ' + url );\n\n\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\tlet script = document.createElement('script');\n\t\t\t\tscript.type = 'text/javascript';\n\t\t\t\tscript.charset = 'utf-8';\n\t\t\t\tscript.async = true;\n\t\t\t\tscript.id = 'injectedBlocksScript';\n\t\t\t\tscript.src = url;\n\t\t\t\tscript.onload = async () => {\n\t\t\t\t\tresolve(script);\n\t\t\t\t\tconst bm = editor.BlockManager;\n\t\t\t\t\t// remove default blocks\n\t\t\t\t\tif (window.CustomBlockLoaderNamespace.removeDefaults === true) {\n\t\t\t\t\t\tbm.getAll().reset();\n\t\t\t\t\t}\n\t\t\t\t\tconst templates: Record<string, string> = {};\n\t\t\t\t\tfor (const id in window.CustomBlockLoaderNamespace.templates) {\n\t\t\t\t\t\tconst file = window.CustomBlockLoaderNamespace.templates[id];\n\t\t\t\t\t\tif (typeof file == 'string') {\n\t\t\t\t\t\t\t// load template file\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\tconst response = await fetch(file);\n\t\t\t\t\t\t\t\tif (response.ok) {\n\t\t\t\t\t\t\t\t\ttemplates[id] = await response.text();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\t\tconsole.error(`Error fetching template file: ${file}`, e);\n\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t// add custom blocks\n\t\t\t\t\tfor (const id in window.CustomBlockLoaderNamespace.blocks) {\n\t\t\t\t\t\tif (typeof id == 'string') {\n\t\t\t\t\t\t\tif ('templateFile' in window.CustomBlockLoaderNamespace.blocks[id] && typeof window.CustomBlockLoaderNamespace.blocks[id].templateFile === 'string') {\n\t\t\t\t\t\t\t\twindow.CustomBlockLoaderNamespace.blocks[id].content = templates[window.CustomBlockLoaderNamespace.blocks[id].templateFile] || window.CustomBlockLoaderNamespace.blocks[id].content;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tdelete window.CustomBlockLoaderNamespace.blocks[id].templateFile; // remove template from block item\n\n\t\t\t\t\t\t\tconst blockItem: IBlockItem = window.CustomBlockLoaderNamespace.blocks[id];\n\t\t\t\t\t\t\tconsole.log(blockItem);\n\n\t\t\t\t\t\t\tbm.add(id, blockItem);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\tscript.onerror = (e) => {\n\t\t\t\t\treject(new Error(`Script load error for ${url}`));\n\t\t\t\t};\n\t\t\t\tdocument.body.appendChild(script);\n\t\t\t}).catch((err) => console.log(err.message));\n\t\t}\n\t});\n};\n\n// register the plugin globally so Mautic-GrapesJS can find it during initialization\nif (!window.MauticGrapesJsPlugins) window.MauticGrapesJsPlugins = [];\nwindow.MauticGrapesJsPlugins.push({\n\tname: 'GrapesJsBlockLoader',\n\tplugin: GrapesJsBlockLoader,\n\tcontext: ['page', 'email-mjml', 'email-html'], // options: [page|email-mjml|email-html]\n});\n"],"names":["root","factory","exports","module","define","amd","globalThis","window","this","__webpack_require__","Symbol","toStringTag","Object","defineProperty","value","CustomBlockLoaderNamespace","MauticGrapesJsPlugins","push","name","plugin","editor","console","log","on","themePath","editorType","id","emailBuilder","document","querySelector","pageBuilder","Mautic","builderTheme","themeSelectedBtn","querySelectorAll","Array","from","forEach","button","classList","contains","parentOfThemeSelectedBtn","parentElement","themeHeading","HTMLElement","dataset","theme","toLowerCase","injectedScript","getElementById","remove","Promise","resolve","reject","script","createElement","type","charset","async","src","onload","bm","BlockManager","removeDefaults","getAll","reset","templates","file","fetch","response","ok","text","error","blocks","templateFile","content","blockItem","add","onerror","e","Error","body","appendChild","catch","err","message","context"],"sourceRoot":""}